<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <script type="module" src="/scripts/client.js"></script>
    <script type="module" src="/scripts/responses.js"></script>
    <script>
        /**
         *
         * @type {WebSocket|null}
         */
        let socket = null;

        function generateMessageID(length) {
            if (length === null || length === undefined) {
                length = 8;
            }

            const characterSet = "0123456789ABCDEF";
            function getRandomCharacter() {
                const characterIndex = Math.floor(Math.random() * characterSet.length);
                return characterSet[characterIndex];
            }

            let generatedID = "";

            for (let counter = 0; counter < length; counter++) {
                generatedID += getRandomCharacter();
            }

            return generatedID;
        }

        function sendMessage(message) {
            const payload = {
                "message_id": generateMessageID(),
                "message": message
            }
            const requestData = JSON.stringify(payload, null, 4);
            socket.send(requestData);
        }

        function handleMessage(event) {
            debugger;
        }

        function build_websocket_url(path) {
            const location = window.location;
            return `ws://${location.host}/${path}`;
        }

        function handle_onopen(event) {
            debugger;
            console.log("WebSocket connected!")
        }

        function handleOnClose(event) {
            debugger;
            console.log("WebSocket Disconnected!")
        }

        function handleOnError(event) {
            debugger;
            console.log("WebSocket error encountered!");
        }

        /**
        document.addEventListener("DOMContentLoaded", function(doc, event) {
            debugger;
            const socketURL = build_websocket_url("ws")
            socket = new WebSocket(socketURL);
            socket.onopen = handle_onopen;
            socket.onclose = handleOnClose;
            socket.onerror = handleOnError;
            socket.onmessage = handleMessage;
        })
         **/

        document.addEventListener("DOMContentLoaded", function(event) {
           this.client = new document.YanvClient("ws");
        });
    </script>
</head>
<body>
    <h1>This is the Yanv index page</h1>
</body>
</html>